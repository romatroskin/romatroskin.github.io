---
phase: 06-testing-error-handling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/setupTests.ts
  - src/components/Header/Header.test.tsx
  - src/components/ThemeToggle/ThemeToggle.test.tsx
  - src/components/SkipLink/SkipLink.test.tsx
  - src/App.test.tsx
autonomous: true

must_haves:
  truths:
    - "vitest-axe accessibility tests pass for Header component"
    - "vitest-axe accessibility tests pass for ThemeToggle component"
    - "vitest-axe accessibility tests pass for SkipLink component"
    - "vitest-axe accessibility tests pass for App main page"
  artifacts:
    - path: "src/components/ThemeToggle/ThemeToggle.test.tsx"
      provides: "Accessibility tests for theme toggle"
      min_lines: 20
    - path: "src/components/SkipLink/SkipLink.test.tsx"
      provides: "Accessibility tests for skip link"
      min_lines: 20
  key_links:
    - from: "src/setupTests.ts"
      to: "vitest-axe"
      via: "extend-expect import for toHaveNoViolations"
      pattern: "vitest-axe/extend-expect"
    - from: "*.test.tsx"
      to: "vitest-axe"
      via: "axe() function call in tests"
      pattern: "await axe\\(container\\)"
---

<objective>
Add comprehensive accessibility testing using vitest-axe to catch WCAG violations automatically.

Purpose: Automated accessibility testing catches ~57% of WCAG issues automatically, preventing accessibility regressions as the codebase evolves. Tests integrate into existing test files for maintainability.

Output: vitest-axe configured and accessibility tests added to major interactive components.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-testing-error-handling/06-RESEARCH.md

@src/setupTests.ts
@src/components/Header/Header.test.tsx
@src/App.test.tsx
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install vitest-axe and configure test setup</name>
  <files>package.json, src/setupTests.ts</files>
  <action>
1. Install vitest-axe:
   ```bash
   npm install --save-dev vitest-axe
   ```

2. Update src/setupTests.ts:
   - Add `import 'vitest-axe/extend-expect'` at the top (after vitest imports)
   - This extends expect with `toHaveNoViolations()` matcher
   - Keep all existing setup (jest-dom matchers, cleanup, ResizeObserver mock)
   - Note: If Plan 06-01 already added React Spring Globals, keep that too

3. Verify jsdom is test environment (it is - confirmed in vite.config.ts)
   - vitest-axe requires jsdom, not happy-dom
   - Current config is correct: `environment: 'jsdom'`
  </action>
  <verify>
   - Run `npm test -- --run` to verify tests still pass
   - Check package.json has vitest-axe in devDependencies
  </verify>
  <done>
   - vitest-axe is installed
   - toHaveNoViolations matcher is available in tests
   - Existing tests continue to pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Add accessibility tests to existing test files</name>
  <files>src/components/Header/Header.test.tsx, src/App.test.tsx</files>
  <action>
1. Update src/components/Header/Header.test.tsx:
   - Import `{ axe }` from 'vitest-axe'
   - Add test: `it('has no accessibility violations', async () => { ... })`
   - Render Header with required props (currentPage, onNavigate)
   - Call `const results = await axe(container)`
   - Assert `expect(results).toHaveNoViolations()`
   - Add test for navigation landmark: `expect(getByRole('navigation')).toBeInTheDocument()`

2. Update src/App.test.tsx:
   - Import `{ axe }` from 'vitest-axe'
   - Add describe block for accessibility tests
   - Add test: `it('has no accessibility violations on initial render', async () => { ... })`
   - Use `await waitFor` if needed for async rendering
   - Add test for main landmark: `expect(getByRole('main')).toBeInTheDocument()`
   - Add test for banner landmark (header): `expect(getByRole('banner')).toBeInTheDocument()`

   Note: App test may need mocking for Parallax. If tests fail with Parallax errors:
   - Mock @react-spring/parallax with simple div wrapper
   - Or test App's accessibility through integration test approach
  </action>
  <verify>
   - Run `npm test -- --run src/components/Header/Header.test.tsx` - passes
   - Run `npm test -- --run src/App.test.tsx` - passes
  </verify>
  <done>
   - Header has accessibility test with toHaveNoViolations
   - App has accessibility test covering main structure
   - Navigation and main landmarks verified
  </done>
</task>

<task type="auto">
  <name>Task 3: Create accessibility tests for ThemeToggle and SkipLink</name>
  <files>src/components/ThemeToggle/ThemeToggle.test.tsx, src/components/SkipLink/SkipLink.test.tsx</files>
  <action>
1. Create src/components/ThemeToggle/ThemeToggle.test.tsx:
   - Import { describe, it, expect } from 'vitest'
   - Import { render, screen } from '@testing-library/react'
   - Import userEvent from '@testing-library/user-event'
   - Import { axe } from 'vitest-axe'
   - Import { ThemeToggle } from './ThemeToggle'

   Tests to include:
   - `it('renders toggle button')` - verify button exists with accessible label
   - `it('has no accessibility violations')` - axe test
   - `it('has accessible name')` - button should have aria-label or visible text
   - `it('toggles theme on click')` - verify click triggers theme change (may need ThemeProvider wrapper)

   Note: ThemeToggle may need ThemeProvider context. Check if it uses useTheme hook.
   If so, wrap in provider or mock the hook.

2. Create src/components/SkipLink/SkipLink.test.tsx:
   - Import { describe, it, expect } from 'vitest'
   - Import { render, screen } from '@testing-library/react'
   - Import { axe } from 'vitest-axe'
   - Import { SkipLink } from './SkipLink'

   Tests to include:
   - `it('renders skip link')` - verify link exists
   - `it('has no accessibility violations')` - axe test
   - `it('has correct href')` - verify href points to main content
   - `it('has accessible text')` - verify "Skip to main content" or similar
   - `it('is focusable')` - verify link can receive focus

3. Run all tests to ensure no regressions
  </action>
  <verify>
   - Run `npm test -- --run` - all tests pass
   - Run `npm run build` - builds successfully
  </verify>
  <done>
   - ThemeToggle has comprehensive accessibility tests
   - SkipLink has comprehensive accessibility tests
   - All vitest-axe tests pass
   - No WCAG violations detected by automated testing
  </done>
</task>

</tasks>

<verification>
1. Test suite: `npm test -- --run` passes all tests including new a11y tests
2. Coverage: Verify axe tests exist for Header, App, ThemeToggle, SkipLink
3. Build: `npm run build` succeeds without errors
4. No violations: All toHaveNoViolations assertions pass
</verification>

<success_criteria>
- vitest-axe is installed and configured
- Header accessibility test passes with no violations
- App accessibility test passes with no violations
- ThemeToggle accessibility test passes with no violations
- SkipLink accessibility test passes with no violations
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-error-handling/06-02-SUMMARY.md`
</output>
