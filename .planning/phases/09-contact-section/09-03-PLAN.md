---
phase: 09-contact-section
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - src/components/sections/ContactSection/ContactSection.test.tsx
autonomous: false

must_haves:
  truths:
    - "ContactSection passes accessibility audit (vitest-axe)"
    - "Form renders all required fields with labels"
    - "Validation errors trigger on blur for empty fields"
    - "Success message appears after form submission"
    - "Social links render with accessible labels"
  artifacts:
    - path: "src/components/sections/ContactSection/ContactSection.test.tsx"
      provides: "Vitest tests for ContactSection"
      min_lines: 50
  key_links:
    - from: "src/components/sections/ContactSection/ContactSection.test.tsx"
      to: "ContactSection"
      via: "render import"
      pattern: "import.*ContactSection"
---

<objective>
Add comprehensive tests for ContactSection and verify accessibility compliance.

Purpose: Ensure the contact section meets accessibility requirements and behaves correctly across all interaction patterns. Tests serve as documentation and prevent regressions.

Output: Vitest test file with accessibility and interaction tests, plus visual verification checkpoint.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-contact-section/09-CONTEXT.md
@.planning/phases/09-contact-section/09-RESEARCH.md
@.planning/phases/09-contact-section/09-01-SUMMARY.md
@.planning/phases/09-contact-section/09-02-SUMMARY.md
@src/components/sections/ContactSection/ContactSection.tsx
@src/components/ui/ThemeToggle/ThemeToggle.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive ContactSection tests</name>
  <files>src/components/sections/ContactSection/ContactSection.test.tsx</files>
  <action>
    Create test file following existing test patterns (ThemeToggle.test.tsx):

    ```typescript
    import { describe, it, expect, vi, beforeEach } from 'vitest';
    import { render, screen, waitFor } from '@testing-library/react';
    import userEvent from '@testing-library/user-event';
    import { axe } from 'vitest-axe';
    import ContactSection from './ContactSection';

    // Mock @formspree/react
    const mockHandleSubmit = vi.fn((e) => e.preventDefault());
    vi.mock('@formspree/react', () => ({
      useForm: vi.fn(() => [
        { submitting: false, succeeded: false, errors: [] },
        mockHandleSubmit,
      ]),
      ValidationError: () => null,
    }));

    // Mock react-social-icons
    vi.mock('react-social-icons', () => ({
      SocialIcon: ({ url, 'aria-label': ariaLabel, ...props }: { url: string; 'aria-label'?: string }) => (
        <a href={url} aria-label={ariaLabel} {...props} data-testid="social-icon">
          Social Icon
        </a>
      ),
    }));

    describe('ContactSection', () => {
      beforeEach(() => {
        vi.clearAllMocks();
      });

      describe('Rendering', () => {
        it('renders contact form with all required fields', () => {
          render(<ContactSection />);

          expect(screen.getByLabelText(/name/i)).toBeInTheDocument();
          expect(screen.getByLabelText(/email/i)).toBeInTheDocument();
          expect(screen.getByLabelText(/message/i)).toBeInTheDocument();
          expect(screen.getByRole('button', { name: /send message/i })).toBeInTheDocument();
        });

        it('renders section heading', () => {
          render(<ContactSection />);

          expect(screen.getByRole('heading', { name: /get in touch/i })).toBeInTheDocument();
        });

        it('renders social links', () => {
          render(<ContactSection />);

          const socialIcons = screen.getAllByTestId('social-icon');
          expect(socialIcons).toHaveLength(2);

          // Check GitHub link
          expect(screen.getByLabelText(/github/i)).toHaveAttribute('href', expect.stringContaining('github.com'));

          // Check LinkedIn link
          expect(screen.getByLabelText(/linkedin/i)).toHaveAttribute('href', expect.stringContaining('linkedin.com'));
        });
      });

      describe('Accessibility', () => {
        it('has no accessibility violations', async () => {
          const { container } = render(<ContactSection />);
          const results = await axe(container);
          expect(results).toHaveNoViolations();
        });

        it('has accessible form labels', () => {
          render(<ContactSection />);

          // All inputs have associated labels
          const nameInput = screen.getByLabelText(/name/i);
          const emailInput = screen.getByLabelText(/email/i);
          const messageInput = screen.getByLabelText(/message/i);

          expect(nameInput).toHaveAccessibleName();
          expect(emailInput).toHaveAccessibleName();
          expect(messageInput).toHaveAccessibleName();
        });

        it('marks required fields with aria-required', () => {
          render(<ContactSection />);

          expect(screen.getByLabelText(/name/i)).toHaveAttribute('aria-required', 'true');
          expect(screen.getByLabelText(/email/i)).toHaveAttribute('aria-required', 'true');
          expect(screen.getByLabelText(/message/i)).toHaveAttribute('aria-required', 'true');
        });

        it('has section with proper landmark', () => {
          render(<ContactSection />);

          const section = screen.getByRole('region', { name: /get in touch/i });
          expect(section).toBeInTheDocument();
        });
      });

      describe('Validation', () => {
        it('shows error on blur when name is empty', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const nameInput = screen.getByLabelText(/name/i);
          await user.click(nameInput);
          await user.tab(); // Blur

          await waitFor(() => {
            expect(screen.getByRole('alert')).toHaveTextContent(/name is required/i);
          });
        });

        it('shows error on blur when email is empty', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const emailInput = screen.getByLabelText(/email/i);
          await user.click(emailInput);
          await user.tab(); // Blur

          await waitFor(() => {
            expect(screen.getByRole('alert')).toHaveTextContent(/email is required/i);
          });
        });

        it('shows error for invalid email format', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const emailInput = screen.getByLabelText(/email/i);
          await user.type(emailInput, 'invalid-email');
          await user.tab(); // Blur

          await waitFor(() => {
            expect(screen.getByRole('alert')).toHaveTextContent(/valid email/i);
          });
        });

        it('shows error on blur when message is empty', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const messageInput = screen.getByLabelText(/message/i);
          await user.click(messageInput);
          await user.tab(); // Blur

          await waitFor(() => {
            expect(screen.getByRole('alert')).toHaveTextContent(/message is required/i);
          });
        });

        it('sets aria-invalid when field has error', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const nameInput = screen.getByLabelText(/name/i);
          await user.click(nameInput);
          await user.tab(); // Blur

          await waitFor(() => {
            expect(nameInput).toHaveAttribute('aria-invalid', 'true');
          });
        });

        it('clears error when valid input provided', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const nameInput = screen.getByLabelText(/name/i);
          await user.click(nameInput);
          await user.tab(); // Blur - triggers error

          await waitFor(() => {
            expect(screen.getByRole('alert')).toBeInTheDocument();
          });

          // Now type valid input
          await user.type(nameInput, 'John Doe');

          await waitFor(() => {
            expect(screen.queryByRole('alert')).not.toBeInTheDocument();
          });
        });
      });

      describe('Form Submission', () => {
        it('shows loading state during submission', async () => {
          const { useForm } = await import('@formspree/react');
          vi.mocked(useForm).mockReturnValue([
            { submitting: true, succeeded: false, errors: [] },
            mockHandleSubmit,
          ]);

          render(<ContactSection />);

          const submitButton = screen.getByRole('button', { name: /sending/i });
          expect(submitButton).toBeDisabled();
          expect(submitButton).toHaveAttribute('aria-busy', 'true');
        });

        it('shows success message after submission', async () => {
          const { useForm } = await import('@formspree/react');
          vi.mocked(useForm).mockReturnValue([
            { submitting: false, succeeded: true, errors: [] },
            mockHandleSubmit,
          ]);

          render(<ContactSection />);

          expect(screen.getByText(/thank you/i)).toBeInTheDocument();
          expect(screen.queryByRole('form')).not.toBeInTheDocument();
        });

        it('keeps social links visible after success', async () => {
          const { useForm } = await import('@formspree/react');
          vi.mocked(useForm).mockReturnValue([
            { submitting: false, succeeded: true, errors: [] },
            mockHandleSubmit,
          ]);

          render(<ContactSection />);

          const socialIcons = screen.getAllByTestId('social-icon');
          expect(socialIcons).toHaveLength(2);
        });
      });

      describe('Keyboard Navigation', () => {
        it('allows tab navigation through form fields', async () => {
          const user = userEvent.setup();
          render(<ContactSection />);

          const nameInput = screen.getByLabelText(/name/i);
          const emailInput = screen.getByLabelText(/email/i);
          const messageInput = screen.getByLabelText(/message/i);
          const submitButton = screen.getByRole('button', { name: /send message/i });

          // Focus first field
          await user.click(nameInput);
          expect(nameInput).toHaveFocus();

          // Tab to email
          await user.tab();
          expect(emailInput).toHaveFocus();

          // Tab to message
          await user.tab();
          expect(messageInput).toHaveFocus();

          // Tab to submit
          await user.tab();
          expect(submitButton).toHaveFocus();
        });
      });
    });
    ```

    This test file covers:
    - Basic rendering of all form elements
    - Accessibility compliance with vitest-axe
    - ARIA attributes (aria-required, aria-invalid, aria-describedby)
    - Blur-based validation for all fields
    - Email format validation
    - Loading state during submission
    - Success message display
    - Social links rendering
    - Keyboard navigation
  </action>
  <verify>
    Run tests: `npm test -- ContactSection`
    All tests should pass.
    No accessibility violations reported.
  </verify>
  <done>
    ContactSection.test.tsx created with comprehensive tests.
    All tests pass including accessibility audit.
    Blur validation tested for all fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full test suite and verify build</name>
  <files>None (verification only)</files>
  <action>
    Run the complete verification suite:

    1. Run all tests:
    ```bash
    npm test -- --run
    ```
    All tests should pass, including new ContactSection tests.

    2. Run TypeScript check:
    ```bash
    npx tsc --noEmit
    ```
    No TypeScript errors.

    3. Run production build:
    ```bash
    npm run build
    ```
    Build should complete successfully.

    4. Run linter:
    ```bash
    npm run lint
    ```
    Note: Pre-existing lint errors (17) are documented in STATE.md - focus on no new errors.

    If any tests fail, diagnose and fix issues before proceeding.
  </action>
  <verify>
    - `npm test -- --run` exits with code 0
    - `npx tsc --noEmit` exits with code 0
    - `npm run build` creates dist/ successfully
  </verify>
  <done>
    All tests pass (including new ContactSection tests).
    TypeScript compilation succeeds.
    Production build completes without errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete contact section with:
    - Form fields (Name, Email, Message) with blur validation
    - Formspree integration for form submission
    - GitHub and LinkedIn social icons
    - Integration into site navigation (scrolls to Contact)
    - Dark/light theme support
    - Keyboard accessibility
  </what-built>
  <how-to-verify>
    1. Run `npm run dev` and open http://localhost:5173

    2. Navigation check:
       - Verify "Contact" appears in header navigation
       - Click "Contact" - should scroll smoothly to 4th page
       - Verify navigation highlights Contact when on that page

    3. Form validation check:
       - Click in Name field, then Tab out (blur) - should show "Name is required" error
       - Click in Email field, type "invalid", Tab out - should show email format error
       - Type valid email (test@example.com), error should clear
       - Click in Message field, Tab out - should show "Message is required" error

    4. Theme check:
       - Toggle theme (dark/light)
       - Verify contact section card, form inputs, and text adapt correctly
       - Focus indicators should be visible in both themes

    5. Keyboard navigation:
       - Tab through all form fields - should move Name → Email → Message → Send button
       - All elements should have visible focus indicators

    6. Social links check:
       - GitHub and LinkedIn icons visible below form
       - Hover effect works (scale up)
       - Clicking opens in new tab

    7. Visual consistency:
       - Card styling matches other sections (glass morphism effect)
       - Section title has gradient underline
       - Form inputs have consistent styling

    Note: Form submission will return error until Formspree form ID is configured. This is expected - the placeholder ID is documented.
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Run `npm test -- --run` - all tests pass
2. Run `npm run build` - builds without errors
3. Manual verification via development server
4. Lighthouse accessibility audit maintains 100 score
</verification>

<success_criteria>
- ContactSection.test.tsx passes all tests
- Accessibility audit (vitest-axe) reports no violations
- Full test suite passes (100+ tests)
- Production build succeeds
- Visual verification confirms all features work
</success_criteria>

<output>
After completion, create `.planning/phases/09-contact-section/09-03-SUMMARY.md`
</output>
