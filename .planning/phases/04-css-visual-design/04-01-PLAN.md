---
phase: 04-css-visual-design
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/tokens.css
  - src/styles/themes.css
  - src/hooks/useTheme.ts
  - src/components/ThemeToggle/ThemeToggle.tsx
  - src/components/ThemeToggle/ThemeToggle.module.css
  - index.html
  - src/index.css
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between dark and light modes"
    - "Theme preference persists across page refresh"
    - "System preference (prefers-color-scheme) is respected when no manual preference exists"
    - "No flash of unstyled content (FOUC) when page loads"
    - "All text passes WCAG 4.5:1 contrast ratio in both themes"
  artifacts:
    - path: "src/styles/tokens.css"
      provides: "Design tokens (spacing, typography scale, transitions)"
      contains: "--space-"
    - path: "src/styles/themes.css"
      provides: "Theme-specific color definitions for light/dark modes"
      contains: "[data-theme="
    - path: "src/hooks/useTheme.ts"
      provides: "Theme state management and toggle functionality"
      exports: ["useTheme"]
    - path: "src/components/ThemeToggle/ThemeToggle.tsx"
      provides: "Theme toggle button component"
      exports: ["ThemeToggle"]
    - path: "index.html"
      provides: "Inline blocking script for FOUC prevention"
      contains: "data-theme"
  key_links:
    - from: "src/hooks/useTheme.ts"
      to: "document.documentElement.setAttribute"
      via: "DOM attribute for theme"
      pattern: "setAttribute.*data-theme"
    - from: "src/components/ThemeToggle/ThemeToggle.tsx"
      to: "src/hooks/useTheme.ts"
      via: "hook import"
      pattern: "useTheme"
    - from: "index.html"
      to: "localStorage"
      via: "inline script reads theme preference"
      pattern: "localStorage.*theme"
---

<objective>
Create a centralized CSS architecture with design tokens, implement a dark/light theme system using CSS Custom Properties, and ensure WCAG-compliant contrast ratios in both themes.

Purpose: Establish the foundation for all CSS styling with semantic color tokens and a theme toggle that respects user preferences while preventing FOUC.

Output: Design tokens system, theme CSS, useTheme hook, ThemeToggle component, and FOUC prevention script.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-css-visual-design/04-RESEARCH.md
@src/index.css
@src/App.css
@src/App.tsx
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create design tokens and theme system CSS</name>
  <files>
    src/styles/tokens.css
    src/styles/themes.css
  </files>
  <action>
Create two new CSS files in src/styles/:

**tokens.css** - Theme-independent design tokens:
- Spacing scale: --space-xs (0.25rem) through --space-xl (4rem)
- Typography scale: --font-size-sm through --font-size-3xl using rem
- Font families: --font-sans (keep existing Inter, system-ui, Avenir, Helvetica, Arial, sans-serif)
- Border radius: --radius-sm (4px), --radius-md (8px), --radius-lg (16px)
- Transitions: --transition-fast (150ms), --transition-base (300ms), --transition-slow (500ms)

**themes.css** - Theme-specific colors using CSS Custom Properties:
- Light theme (default on :root):
  - --color-bg-primary: #ffffff
  - --color-bg-secondary: #f9f9f9
  - --color-text-primary: #1a1a1a (15.3:1 contrast ✓)
  - --color-text-secondary: #4d4d4d (9.73:1 contrast ✓)
  - --color-accent: #0044cc (8.59:1 contrast ✓)
  - --color-accent-hover: #0055ee (7.2:1 contrast ✓)
  - --color-border: #e0e0e0
  - --color-focus: #535bf2

- Dark theme on [data-theme="dark"]:
  - --color-bg-primary: #0f0f1a
  - --color-bg-secondary: #1a1a2e
  - --color-text-primary: #ffffff (15.8:1 contrast ✓)
  - --color-text-secondary: #d0d0d0 (11.6:1 contrast ✓)
  - --color-accent: #a78bfa (4.89:1 contrast ✓)
  - --color-accent-hover: #c4b5fd (6.2:1 contrast ✓)
  - --color-border: #2a2a3e
  - --color-focus: #7c83ff

- Add @media (prefers-color-scheme: dark) fallback for :root:not([data-theme="light"]) to respect system preference when no explicit choice made.

- Add body transition for smooth theme changes: transition: background-color var(--transition-base), color var(--transition-base)
  </action>
  <verify>
    Files exist: src/styles/tokens.css and src/styles/themes.css
    Both files contain valid CSS with no syntax errors (npm run build succeeds)
  </verify>
  <done>
    Design tokens file defines spacing, typography, radius, and transitions
    Themes file defines light (default) and dark themes with verified contrast ratios
    System preference media query provides fallback
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useTheme hook and ThemeToggle component</name>
  <files>
    src/hooks/useTheme.ts
    src/components/ThemeToggle/ThemeToggle.tsx
    src/components/ThemeToggle/ThemeToggle.module.css
  </files>
  <action>
Create src/hooks/ directory if not exists.

**useTheme.ts** - Theme management hook:
- Initialize theme state by reading from document.documentElement.getAttribute('data-theme')
- Provide toggleTheme() function that:
  1. Swaps theme between 'light' and 'dark'
  2. Updates document.documentElement.setAttribute('data-theme', newTheme)
  3. Saves to localStorage.setItem('theme', newTheme)
- Add useEffect to listen for system preference changes via window.matchMedia('(prefers-color-scheme: dark)')
  - Only update if no localStorage theme is set (user hasn't made explicit choice)
- Export: { theme, toggleTheme }
- Type the theme as 'light' | 'dark'

**ThemeToggle.tsx** - Toggle button component:
- Import and use useTheme hook
- Render button with:
  - aria-label: "Switch to {opposite} mode" (e.g., "Switch to light mode" when dark)
  - onClick: toggleTheme
  - Icon or emoji indicating current theme (sun/moon)
- Apply CSS module styles

**ThemeToggle.module.css** - Styling:
- .toggle: 44x44px minimum size for touch target
- Position will be in header (styles for placement)
- Hover state, focus-visible outline
- Smooth icon transition
  </action>
  <verify>
    TypeScript compilation: npm run build passes
    Hook exports useTheme with { theme, toggleTheme }
    ThemeToggle component renders without errors
  </verify>
  <done>
    useTheme hook manages theme state, localStorage persistence, and system preference listening
    ThemeToggle component provides accessible toggle with proper aria-label
    Touch target is 44x44px minimum
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate theme system and prevent FOUC</name>
  <files>
    index.html
    src/index.css
    src/App.tsx
  </files>
  <action>
**index.html** - Add FOUC prevention:
- Add inline blocking script in <head> BEFORE any CSS links:
```html
<script>
  (function() {
    const theme = localStorage.getItem('theme')
      || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
  })();
</script>
```
- Add <meta name="color-scheme" content="dark light"> for browser hints
- Keep existing CSS links but ensure the script runs first

**src/index.css** - Integrate new styles:
- Add imports at the top:
  @import './styles/tokens.css';
  @import './styles/themes.css';
- Update existing CSS variables to use new semantic tokens (--primary-bg-color -> var(--color-bg-primary), etc.)
- Replace hard-coded colors with CSS variable references
- Ensure body styles use theme variables

**src/App.tsx** - Add ThemeToggle:
- Import ThemeToggle component
- Place ThemeToggle in the header area or pass it to Header component
- Update any inline color values to use CSS variables where feasible (wave colors can stay dynamic)
  </action>
  <verify>
    npm run dev - Site loads without FOUC (check by simulating slow 3G in DevTools)
    Toggle works - clicking switches between light and dark themes
    Refresh persists - theme survives page reload
    System preference works - with localStorage cleared, matches system preference
    npm run build - Production build succeeds
  </verify>
  <done>
    Inline script prevents FOUC by setting theme before CSS loads
    Theme toggle appears in UI and functions correctly
    All existing styles continue to work, now using CSS variables
    Dark mode displays #0f0f1a background, light mode displays #ffffff
  </done>
</task>

</tasks>

<verification>
1. Theme toggle works: Click toggles between light and dark
2. Persistence: Refresh page, theme preference retained
3. System preference: Clear localStorage, toggle system theme, site responds
4. No FOUC: Open in incognito, set localStorage theme manually, refresh - no flash
5. Contrast ratios: Run Lighthouse accessibility audit - no contrast warnings
6. Build succeeds: npm run build completes without errors
</verification>

<success_criteria>
- Design tokens file with spacing, typography, and transition variables
- Light and dark themes with WCAG-verified contrast ratios
- Theme toggle component with 44px+ touch target
- FOUC prevention via inline blocking script
- All existing functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/04-css-visual-design/04-01-SUMMARY.md`
</output>
