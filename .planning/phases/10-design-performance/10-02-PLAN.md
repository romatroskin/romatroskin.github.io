---
phase: 10-design-performance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "PNG images in public/ are optimized during build"
    - "All images have explicit width/height to prevent CLS"
    - "Build produces optimized image assets"
  artifacts:
    - path: "vite.config.ts"
      provides: "Image optimization plugin configuration"
      contains: "ViteImageOptimizer"
    - path: "package.json"
      provides: "vite-plugin-image-optimizer dependency"
      contains: "vite-plugin-image-optimizer"
  key_links:
    - from: "vite.config.ts"
      to: "public/*.png"
      via: "build-time optimization"
      pattern: "ViteImageOptimizer"
---

<objective>
Configure build-time image optimization to compress PNG assets and prevent Cumulative Layout Shift.

Purpose: Optimize images for faster loading (PERF-05) and ensure no layout shifts occur when images load (PERF-07, DSGN-05).

Output: vite-plugin-image-optimizer configured in vite.config.ts, optimized images in build output.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-design-performance/10-RESEARCH.md

@vite.config.ts
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure vite-plugin-image-optimizer</name>
  <files>package.json, vite.config.ts</files>
  <action>
1. Install the image optimization plugin:
   ```bash
   npm install --save-dev vite-plugin-image-optimizer
   ```

2. Update vite.config.ts to add the image optimizer plugin:
   ```typescript
   import { ViteImageOptimizer } from 'vite-plugin-image-optimizer';

   // Add to plugins array:
   ViteImageOptimizer({
     png: {
       quality: 80,
     },
     jpeg: {
       quality: 75,
     },
     webp: {
       quality: 80,
     },
     // Skip SVG optimization (already optimized)
     svg: false,
   }),
   ```

3. Place the ViteImageOptimizer AFTER the compression plugins (Brotli/Gzip) so images are optimized before compression.

Note: The plugin will automatically optimize PNG files in public/ during build (favicon-16x16.png, favicon-32x32.png, apple-touch-icon.png, icon-192.png, icon-512.png, og-image.png, logo.png).
  </action>
  <verify>
1. Run `npm run build` - build succeeds
2. Check dist/ folder - PNG files should be smaller than source files
3. Run `npm run preview` and verify images load correctly
  </verify>
  <done>vite-plugin-image-optimizer installed and configured, build produces optimized images</done>
</task>

<task type="auto">
  <name>Task 2: Verify image dimensions for CLS prevention</name>
  <files>src/App.tsx, index.html</files>
  <action>
1. Verify the logo image in App.tsx has width/height attributes (already present: width="200" height="200").

2. Check index.html for any images in meta tags - OG image doesn't need width/height in HTML (only og:image:width/height meta tags matter for social sharing).

3. If any images are missing dimensions, add explicit width and height attributes.

Current state review:
- Logo SVG: Has width="200" height="200" - GOOD
- Favicons: Referenced in link tags, dimensions set via sizes attribute - GOOD
- OG image: Meta tags only, no HTML img element - N/A

The site primarily uses SVG for the logo and PNGs for icons/OG image. No content images that would cause CLS.

Document this finding - no changes needed if all images already have proper dimensions.
  </action>
  <verify>
1. Run `npm run dev`
2. Open Chrome DevTools > Lighthouse > Performance
3. Check for "Image elements do not have explicit width and height" warning - should not appear
4. Check CLS in Lighthouse metrics - should be < 0.1
  </verify>
  <done>All images have explicit dimensions or don't require them (meta tags), no CLS warnings from images</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build` succeeds without errors
2. Images optimized: Compare file sizes in dist/ vs public/ - PNG files should be smaller
3. Preview works: `npm run preview` shows all images correctly
4. No CLS warnings: Lighthouse audit doesn't flag missing image dimensions
</verification>

<success_criteria>
- vite-plugin-image-optimizer added to devDependencies
- vite.config.ts includes ViteImageOptimizer configuration
- Build produces optimized PNG files
- No new CLS issues introduced
</success_criteria>

<output>
After completion, create `.planning/phases/10-design-performance/10-02-SUMMARY.md`
</output>
