---
phase: 07-seo-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Search engine crawlers can fetch https://puffpuff.dev/sitemap.xml with valid URL entries"
    - "Search engine crawlers receive robots.txt with Allow: / and Sitemap reference"
    - "Browser receives Brotli-compressed assets when Accept-Encoding: br is sent"
    - "Browser receives gzip-compressed assets as fallback when Brotli unavailable"
  artifacts:
    - path: "vite.config.ts"
      provides: "Vite plugin configuration for sitemap and compression"
      contains: "vite-plugin-sitemap"
    - path: "dist/sitemap.xml"
      provides: "Generated sitemap for search engines"
    - path: "dist/robots.txt"
      provides: "Generated robots.txt with sitemap reference"
  key_links:
    - from: "vite.config.ts"
      to: "dist/sitemap.xml"
      via: "vite-plugin-sitemap generates on build"
      pattern: "Sitemap\\("
    - from: "vite.config.ts"
      to: "dist/assets/*.br"
      via: "vite-plugin-compression generates .br files"
      pattern: "viteCompression\\("
---

<objective>
Configure Vite build plugins for sitemap generation, robots.txt, and Brotli pre-compression.

Purpose: Search engines discover the site via sitemap.xml, build assets are pre-compressed for faster loading.
Output: Updated vite.config.ts with sitemap and compression plugins, package.json with new dev dependencies.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-seo-foundation/07-CONTEXT.md
@.planning/phases/07-seo-foundation/07-RESEARCH.md
@vite.config.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Vite build plugins</name>
  <files>package.json</files>
  <action>
Install the required Vite plugins as dev dependencies:

```bash
npm install -D vite-plugin-sitemap vite-plugin-compression
```

These are:
- vite-plugin-sitemap: Generates sitemap.xml and robots.txt at build time
- vite-plugin-compression: Pre-compresses assets with Brotli and gzip

Do NOT install react-helmet-async (per research, static meta tags in index.html are sufficient for GitHub Pages).
  </action>
  <verify>
    - `npm ls vite-plugin-sitemap` shows installed version
    - `npm ls vite-plugin-compression` shows installed version
    - `npm install` succeeds without errors
  </verify>
  <done>
    - vite-plugin-sitemap added to devDependencies
    - vite-plugin-compression added to devDependencies
    - package-lock.json updated
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Vite plugins</name>
  <files>vite.config.ts</files>
  <action>
Update vite.config.ts to add sitemap and compression plugins:

1. Add imports at top:
```typescript
import Sitemap from 'vite-plugin-sitemap';
import viteCompression from 'vite-plugin-compression';
```

2. Add plugins to the plugins array (after existing plugins):

```typescript
// Generate sitemap.xml and robots.txt
Sitemap({
  hostname: 'https://puffpuff.dev',
  dynamicRoutes: ['/'],
  changefreq: 'monthly',
  priority: 1.0,
  lastmod: new Date().toISOString().split('T')[0],
  generateRobotsTxt: true,
  robots: [
    {
      userAgent: '*',
      allow: '/',
    }
  ]
}),

// Brotli compression (primary)
viteCompression({
  algorithm: 'brotliCompress',
  ext: '.br',
  threshold: 1024,
  deleteOriginFile: false,
  compressionOptions: {
    level: 11
  }
}),

// Gzip compression (fallback)
viteCompression({
  algorithm: 'gzip',
  ext: '.gz',
  threshold: 1024,
  deleteOriginFile: false
})
```

Keep existing plugins (react, visualizer) and test config.
  </action>
  <verify>
    - `grep "vite-plugin-sitemap" vite.config.ts` shows import
    - `grep "viteCompression" vite.config.ts` shows usage
    - `grep "puffpuff.dev" vite.config.ts` shows hostname
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
    - vite.config.ts imports sitemap and compression plugins
    - Sitemap configured with hostname https://puffpuff.dev
    - Brotli compression configured at level 11
    - Gzip fallback configured
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify build generates sitemap and compressed files</name>
  <files>dist/sitemap.xml, dist/robots.txt, dist/assets/*.br</files>
  <action>
Run production build and verify generated files:

```bash
npm run build
```

Then verify:
1. sitemap.xml exists: `ls dist/sitemap.xml`
2. robots.txt exists: `ls dist/robots.txt`
3. Compressed files exist: `ls dist/assets/*.br | head -5`
4. Check sitemap content: `cat dist/sitemap.xml`
5. Check robots.txt content: `cat dist/robots.txt`

Expected sitemap.xml content:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>https://puffpuff.dev/</loc>
    <lastmod>2026-02-04</lastmod>
    <changefreq>monthly</changefreq>
    <priority>1.0</priority>
  </url>
</urlset>
```

Expected robots.txt should include:
- User-agent: *
- Allow: /
- Sitemap: https://puffpuff.dev/sitemap.xml
  </action>
  <verify>
    - `test -f dist/sitemap.xml && echo "EXISTS"` shows EXISTS
    - `test -f dist/robots.txt && echo "EXISTS"` shows EXISTS
    - `ls dist/assets/*.br | wc -l` shows multiple .br files
    - `grep "puffpuff.dev" dist/sitemap.xml` shows hostname in sitemap
  </verify>
  <done>
    - sitemap.xml generated with correct hostname
    - robots.txt generated with Allow and Sitemap directives
    - .br files generated for JS/CSS assets
    - .gz files generated as fallback
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `cat dist/sitemap.xml` shows valid sitemap with https://puffpuff.dev
3. `cat dist/robots.txt` shows User-agent, Allow, and Sitemap directives
4. `ls -la dist/assets/*.br` shows Brotli-compressed files
5. Compare sizes: `ls -la dist/assets/index*.js dist/assets/index*.js.br` shows ~30-40% reduction
</verification>

<success_criteria>
- SEO-05: sitemap.xml generated at build time - DONE
- SEO-06: robots.txt configured correctly - DONE
- ARCH-04: Brotli pre-compression configured for production build - DONE
</success_criteria>

<output>
After completion, create `.planning/phases/07-seo-foundation/07-03-SUMMARY.md`
</output>
