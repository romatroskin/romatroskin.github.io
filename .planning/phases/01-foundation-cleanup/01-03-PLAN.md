---
phase: 01-foundation-cleanup
plan: 03
type: execute
wave: 2
depends_on: ["01-02"]
files_modified:
  - package.json
  - src/App.tsx
  - src/components/Waves.tsx
  - src/components/Header/Header.tsx
  - src/components/Header/Header.module.css
  - src/components/Header/header.css
  - src/components/Quotes.tsx
  - src/index.css
  - vite.config.ts
autonomous: true

must_haves:
  truths:
    - "Bundle does not include lodash (verified via bundle analysis)"
    - "PureCSS is removed from project"
    - "Header renders correctly with CSS Modules"
    - "Quotes component and references are removed"
  artifacts:
    - path: "src/components/Header/Header.module.css"
      provides: "CSS Modules styling for header menu"
      min_lines: 30
    - path: "dist/stats.html"
      provides: "Bundle analysis visualization"
  key_links:
    - from: "src/components/Header/Header.tsx"
      to: "src/components/Header/Header.module.css"
      via: "CSS Modules import"
      pattern: "import.*Header\\.module\\.css"
---

<objective>
Remove lodash dependency, PureCSS, and dead code (Quotes component). Replace PureCSS with CSS Modules for the Header. Add bundle visualizer to verify lodash removal.

Purpose: Reduce bundle size by removing unused dependencies. PureCSS is only used for the header menu and is effectively unmaintained (last updated 2019). CSS Modules provide scoped styling with zero runtime cost and align with Phase 4 CSS organization.

Output: Leaner bundle without lodash or PureCSS, Header styled with CSS Modules, bundle analysis report.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-cleanup/01-RESEARCH.md
@.planning/phases/01-foundation-cleanup/01-02-SUMMARY.md

@src/components/Header/Header.tsx
@src/components/Header/header.css
@src/components/Waves.tsx
@package.json
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove lodash from Waves.tsx and uninstall</name>
  <files>src/components/Waves.tsx, package.json</files>
  <action>
Remove lodash usage from Waves.tsx and uninstall the package.

**In Waves.tsx line 3:**
```typescript
import { random } from "lodash";
```
Remove this import.

**In Waves.tsx line 46 (constructor):**
```typescript
this._noise = new Perlin(random(true));
```

Replace with:
```typescript
this._noise = new Perlin(Math.random());
```

The `random(true)` in lodash returns a floating point number between 0 and 1, which is exactly what `Math.random()` returns.

**Then uninstall lodash:**
```bash
npm uninstall lodash @types/lodash
```

Note: App.tsx lodash import was already removed in Plan 01-02.
  </action>
  <verify>
Run `grep -rn "from 'lodash'" src/` - returns no results.
Run `grep -rn "from \"lodash\"" src/` - returns no results.
Run `cat package.json | grep lodash` - returns no results.
  </verify>
  <done>Lodash removed from all source files and uninstalled from package.json.</done>
</task>

<task type="auto">
  <name>Task 2: Delete Quotes component and references</name>
  <files>src/components/Quotes.tsx, src/App.tsx</files>
  <action>
Remove the Quotes component entirely.

1. Delete the file: `src/components/Quotes.tsx`

2. In src/App.tsx, ensure the commented Quotes reference is also removed:
   - Line 118: `{/* <Quotes /> */}`

   Delete this commented line. It's dead code.

3. Also remove any other commented-out code blocks in App.tsx:
   - Lines 131-148: Large commented block with viteLogo and count button
   - Any other `{/* ... */}` comments that are dead code (not explanatory comments)

Keep only meaningful code and comments that explain behavior.
  </action>
  <verify>
Run `ls src/components/Quotes.tsx` - file should not exist.
Run `grep -n "Quotes" src/App.tsx` - returns no results.
  </verify>
  <done>Quotes component deleted and all references removed from App.tsx.</done>
</task>

<task type="auto">
  <name>Task 3: Replace PureCSS with CSS Modules for Header</name>
  <files>
    src/components/Header/Header.tsx
    src/components/Header/Header.module.css
    src/components/Header/header.css
    src/index.css
    package.json
  </files>
  <action>
Replace PureCSS with CSS Modules for the Header component.

**1. Create src/components/Header/Header.module.css:**

```css
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 5;
  padding: 0.5rem;
  background: transparent;
  transition: transform 400ms ease;
}

.menu {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.logo {
  width: 1.5rem;
  height: 1.5rem;
  background: url('https://raw.githubusercontent.com/PuffPuffDev/puff_puff_brand/main/logos/dp_white.svg') no-repeat center center;
  background-size: contain;
  display: block;
}

.navList {
  list-style: none;
  display: flex;
  gap: 1rem;
  margin: 0;
  padding: 0;
}

.navItem {
  /* Individual nav item styling */
}

.navLink {
  color: white;
  text-decoration: none;
  padding: 0.5rem 1rem;
  transition: color 0.3s ease;
}

.navLink:hover,
.navLink:focus {
  color: #535bf2;
  background: none;
}

.navLinkActive {
  color: #535bf2;
}

@media only screen and (max-width: 375px) {
  .logo {
    display: none;
  }
}
```

**2. Update src/components/Header/Header.tsx:**

```tsx
import { animated } from "react-spring";
import styles from "./Header.module.css";

function Header() {
  return (
    <animated.header className={styles.header}>
      <nav className={styles.menu}>
        <a href="#" className={styles.logo} aria-label="Puff Puff Dev Home" />
        <ul className={styles.navList}>
          <li className={styles.navItem}>
            <a href="#" className={`${styles.navLink} ${styles.navLinkActive}`}>
              Home
            </a>
          </li>
          <li className={styles.navItem}>
            <a href="#" className={styles.navLink}>
              About
            </a>
          </li>
          <li className={styles.navItem}>
            <a href="#" className={styles.navLink}>
              Services
            </a>
          </li>
          <li className={styles.navItem}>
            <a href="#" className={styles.navLink}>
              Contact
            </a>
          </li>
        </ul>
      </nav>
    </animated.header>
  );
}

export default Header;
```

Remove the empty `Header.propTypes = {};` line.
Remove the old `import "./header.css";` line.

**3. Delete the old CSS file:**
Delete `src/components/Header/header.css`

**4. Remove PureCSS from index.css:**
In src/index.css, remove any PureCSS imports:
```css
@import 'purecss/build/pure-min.css';
```
or similar lines.

**5. Uninstall PureCSS:**
```bash
npm uninstall purecss
```
  </action>
  <verify>
Run `npm run build` - builds successfully.
Run `npm run dev` - start dev server and visually verify header renders correctly.
Run `cat package.json | grep purecss` - returns no results.
Run `ls src/components/Header/` - shows Header.tsx and Header.module.css only.
  </verify>
  <done>Header uses CSS Modules. PureCSS removed from project.</done>
</task>

<task type="auto">
  <name>Task 4: Add bundle visualizer and verify bundle</name>
  <files>vite.config.ts, package.json</files>
  <action>
Add rollup-plugin-visualizer to verify bundle composition.

**1. Install visualizer:**
```bash
npm install -D rollup-plugin-visualizer
```

**2. Update vite.config.ts:**

Add import at top:
```typescript
import { visualizer } from 'rollup-plugin-visualizer'
```

Add visualizer to plugins array:
```typescript
plugins: [
  react(),
  visualizer({
    filename: './dist/stats.html',
    open: false,  // Don't auto-open, we'll check manually
    gzipSize: true,
    brotliSize: true
  })
],
```

**3. Run production build:**
```bash
npm run build
```

**4. Verify bundle:**
- Check dist/stats.html exists
- Verify lodash is NOT in the bundle (search for "lodash" in the HTML)
- Verify purecss is NOT in the bundle
  </action>
  <verify>
Run `npm run build` - completes successfully.
Run `ls dist/stats.html` - file exists.
Run `grep -i "lodash" dist/stats.html` - returns no results (lodash not in bundle).
Run `grep -i "purecss" dist/stats.html` - returns no results.
  </verify>
  <done>Bundle visualizer added. Bundle verified to not contain lodash or PureCSS.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes successfully
2. `grep -rn "lodash" src/` returns no results
3. `grep -rn "purecss" src/` returns no results
4. `cat package.json | grep -E "lodash|purecss"` returns no results
5. `ls src/components/Quotes.tsx` fails (file deleted)
6. dist/stats.html shows no lodash or purecss chunks
7. Header renders correctly in browser with CSS Modules
</verification>

<success_criteria>
- Lodash completely removed from codebase and bundle
- PureCSS completely removed from codebase and bundle
- Quotes.tsx deleted with no remaining references
- Header styled with CSS Modules and renders correctly
- Bundle analysis report generated at dist/stats.html
- Bundle size reduced compared to before cleanup
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-cleanup/01-03-SUMMARY.md`
</output>
