---
phase: 03-navigation-core-a11y
plan: 04
type: execute
wave: 3
depends_on: ["03-01", "03-02", "03-03"]
files_modified:
  - src/App.tsx
  - src/components/Header/Header.tsx
autonomous: false

must_haves:
  truths:
    - "Skip link is first focusable element on page"
    - "Skip link jumps to main content when activated"
    - "Navigation links scroll to correct sections"
    - "Active section is highlighted in navigation"
    - "Mobile menu fully functional"
    - "All focus indicators visible during keyboard navigation"
  artifacts:
    - path: "src/App.tsx"
      provides: "Complete accessible navigation integration"
      contains: "SkipLink"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/SkipLink/SkipLink.tsx"
      via: "import SkipLink"
      pattern: "SkipLink"
---

<objective>
Integrate all navigation components and perform visual/functional verification of Phase 3.

Purpose: Wire together skip link, scroll spy, and all navigation components. Verify full accessibility flow works end-to-end.
Output: Fully integrated accessible navigation with human verification of all success criteria.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-core-a11y/03-RESEARCH.md
@.planning/phases/03-navigation-core-a11y/03-01-SUMMARY.md
@.planning/phases/03-navigation-core-a11y/03-02-SUMMARY.md
@.planning/phases/03-navigation-core-a11y/03-03-SUMMARY.md

Reference:
@src/App.tsx
@src/components/Header/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate SkipLink and finalize App.tsx navigation</name>
  <files>src/App.tsx</files>
  <action>
Update `src/App.tsx`:

1. Import SkipLink:
```tsx
import { SkipLink } from './components/SkipLink/SkipLink';
```

2. Add SkipLink as FIRST element in return (before Header):
```tsx
return (
  <>
    <SkipLink href="#main-content" />
    <Header onNavigate={scrollToPage} currentPage={currentPage} />
    ...
  </>
);
```

3. Ensure useScrollSpy is connected to currentPage state:
- If useScrollSpy returns section ID, map it to page number:
```tsx
const sectionToPage: Record<string, number> = {
  'hero-section': 0,
  'services-section': 1,
  'about-section': 2,
};

// Use scroll spy for currentPage when available
const activeSection = useScrollSpy(['hero-section', 'services-section', 'about-section'], {
  root: parallaxRef.current?.container?.current || null,
});

useEffect(() => {
  if (activeSection && sectionToPage[activeSection] !== undefined) {
    setCurrentPage(sectionToPage[activeSection]);
  }
}, [activeSection]);
```

4. Ensure `<main id="main-content">` wraps the parallax content (from 03-01)

5. Verify all section IDs and aria-labelledby attributes are in place

IMPORTANT: If scroll spy doesn't work correctly with Parallax container, there are two approaches:
a) Pass `root: parallaxRef.current?.container?.current` to observer options
b) Fall back to the existing scroll-based page detection (which already works)

Test both - if scroll spy integration causes issues, keep existing scroll detection for now and note in SUMMARY.
  </action>
  <verify>
- `npm run build` succeeds
- Tab to first element on page - should be skip link
- Activate skip link - focus moves to main content
- Scroll through pages - Header shows correct active state
  </verify>
  <done>All navigation components integrated and working together</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete accessible navigation system for Phase 3:
- Skip-to-content link (first focusable element)
- Semantic HTML landmarks (header, main, section)
- Scroll spy for active navigation state
- Mobile hamburger menu with focus trap
- Keyboard navigation with visible focus indicators
- ARIA attributes for screen reader support
  </what-built>
  <how-to-verify>
**Start dev server:** `npm run dev`

**1. Skip Link Test:**
- Open page in browser, press Tab once
- Skip link should appear at top left ("Skip to main content")
- Press Enter - focus should move to main content area
- Press Tab again - should continue to next focusable element

**2. Keyboard Navigation Test:**
- Reload page, press Tab repeatedly
- Verify visible focus ring on each focusable element (links, buttons)
- Navigate to header nav links, press Enter - should scroll to section
- Verify active state changes in navigation as you navigate

**3. Mobile Menu Test:**
- Resize browser to < 768px (or use DevTools mobile view)
- Hamburger button should appear, desktop nav should hide
- Click hamburger - menu slides in from right with blur backdrop
- Press Tab - focus should cycle within menu only (trapped)
- Press Escape - menu should close, focus returns to hamburger button
- Re-open menu, click backdrop - menu should close
- Re-open menu, click a nav item - should scroll to section AND close menu

**4. Scroll Navigation Test:**
- Scroll through the page
- Navigation should highlight current section (active state visible)
- Click nav links - should smooth scroll to sections

**5. Screen Reader Test (optional but recommended):**
- Use VoiceOver (Mac: Cmd+F5) or NVDA (Windows)
- Navigate by landmarks (VO: Ctrl+Alt+U, then landmarks)
- Should announce: banner (header), main, multiple regions (sections)
- Navigate by headings - should find h1 and h2 elements

**Report any issues found.**
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After human verification:
1. All 5 test categories pass
2. No critical accessibility issues found
3. Navigation works on both desktop and mobile
4. Keyboard-only navigation is fully functional
</verification>

<success_criteria>
Phase 3 Success Criteria (from ROADMAP.md):
1. [x] Clicking nav links smooth-scrolls to corresponding section
2. [x] Current section is visually highlighted in navigation as user scrolls
3. [x] Mobile users can open hamburger menu, select section, menu closes
4. [x] User can Tab through all interactive elements with visible focus indicators
5. [x] Screen reader announces navigation landmarks and section headings correctly
6. [x] Skip-to-content link is first focusable element and jumps to main content
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-core-a11y/03-04-SUMMARY.md`
</output>
