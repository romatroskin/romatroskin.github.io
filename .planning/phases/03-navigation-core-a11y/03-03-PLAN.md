---
phase: 03-navigation-core-a11y
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - src/components/Header/MobileMenu.tsx
  - src/components/Header/MobileMenu.module.css
  - src/components/Header/Header.tsx
  - src/components/Header/Header.module.css
autonomous: true

must_haves:
  truths:
    - "Mobile menu opens when hamburger button is clicked"
    - "Mobile menu closes when Escape key is pressed"
    - "Mobile menu closes when backdrop is clicked"
    - "Focus is trapped inside mobile menu when open"
    - "Background scroll is disabled when menu is open"
    - "Clicking nav link scrolls to section and closes menu"
  artifacts:
    - path: "src/components/Header/MobileMenu.tsx"
      provides: "Accessible mobile navigation menu with focus trap"
      exports: ["MobileMenu"]
    - path: "src/components/Header/MobileMenu.module.css"
      provides: "Mobile menu styling with backdrop blur"
      contains: "backdrop-filter"
    - path: "src/components/Header/Header.tsx"
      provides: "Updated header with mobile menu integration"
      contains: "MobileMenu"
  key_links:
    - from: "src/components/Header/Header.tsx"
      to: "src/components/Header/MobileMenu.tsx"
      via: "import MobileMenu"
      pattern: "MobileMenu"
    - from: "src/components/Header/MobileMenu.tsx"
      to: "focus-trap-react"
      via: "FocusTrap wrapper"
      pattern: "FocusTrap"
---

<objective>
Create accessible mobile hamburger menu with focus trap, scroll lock, and ARIA support.

Purpose: Mobile users need a way to navigate the site. Focus trapping ensures keyboard users don't get lost, scroll lock prevents background scrolling on iOS.
Output: MobileMenu component with focus-trap-react integration, Header updated to show/hide menu.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-navigation-core-a11y/03-RESEARCH.md
@.planning/phases/03-navigation-core-a11y/03-01-SUMMARY.md
@.planning/phases/03-navigation-core-a11y/03-02-SUMMARY.md

Reference existing:
@src/components/Header/Header.tsx
@src/components/Header/Header.module.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileMenu component with focus trap</name>
  <files>src/components/Header/MobileMenu.tsx, src/components/Header/MobileMenu.module.css</files>
  <action>
Create `src/components/Header/MobileMenu.tsx`:

```tsx
import { useEffect } from 'react';
import FocusTrap from 'focus-trap-react';
import { disableBodyScroll, enableBodyScroll, clearAllBodyScrollLocks } from 'body-scroll-lock';
import styles from './MobileMenu.module.css';

interface NavItem {
  label: string;
  page: number;
  isExternal?: boolean;
  href?: string;
}

interface MobileMenuProps {
  isOpen: boolean;
  onClose: () => void;
  navItems: NavItem[];
  onNavigate: (page: number) => void;
  currentPage: number;
}

export function MobileMenu({ isOpen, onClose, navItems, onNavigate, currentPage }: MobileMenuProps) {
  // Prevent body scroll when menu is open (iOS Safari compatible)
  useEffect(() => {
    if (isOpen) {
      disableBodyScroll(document.body);
    } else {
      enableBodyScroll(document.body);
    }
    return () => clearAllBodyScrollLocks();
  }, [isOpen]);

  if (!isOpen) return null;

  const handleNavClick = (e: React.MouseEvent, item: NavItem) => {
    if (item.isExternal) return; // Let external links work normally
    e.preventDefault();
    onNavigate(item.page);
    onClose();
  };

  return (
    <FocusTrap
      focusTrapOptions={{
        escapeDeactivates: true,
        clickOutsideDeactivates: true,
        onDeactivate: onClose,
        initialFocus: '#mobile-menu-close',
        returnFocusOnDeactivate: true,
      }}
    >
      <div className={styles.overlay} onClick={onClose} aria-hidden="true">
        <nav
          className={styles.menu}
          onClick={(e) => e.stopPropagation()}
          aria-label="Mobile navigation"
          role="dialog"
          aria-modal="true"
        >
          <button
            id="mobile-menu-close"
            onClick={onClose}
            className={styles.closeButton}
            aria-label="Close menu"
          >
            <span aria-hidden="true">&times;</span>
          </button>

          <ul className={styles.navList}>
            {navItems.map((item) => (
              <li key={item.label} className={styles.navItem}>
                {item.isExternal ? (
                  <a
                    href={item.href}
                    className={styles.navLink}
                    onClick={onClose}
                  >
                    {item.label}
                  </a>
                ) : (
                  <a
                    href="#"
                    className={`${styles.navLink} ${currentPage === item.page ? styles.navLinkActive : ''}`}
                    onClick={(e) => handleNavClick(e, item)}
                    aria-current={currentPage === item.page ? 'page' : undefined}
                  >
                    {item.label}
                  </a>
                )}
              </li>
            ))}
          </ul>
        </nav>
      </div>
    </FocusTrap>
  );
}
```

Create `src/components/Header/MobileMenu.module.css`:

```css
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  z-index: 9998;
  animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.menu {
  position: fixed;
  top: 0;
  right: 0;
  width: 280px;
  max-width: 80vw;
  height: 100vh;
  background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
  padding: 60px 24px 24px;
  z-index: 9999;
  animation: slideIn 0.3s ease-out;
  box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
}

@keyframes slideIn {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

@media (prefers-reduced-motion: reduce) {
  .overlay,
  .menu {
    animation: none;
  }
}

.closeButton {
  position: absolute;
  top: 16px;
  right: 16px;
  width: 44px;
  height: 44px;
  background: transparent;
  border: none;
  color: #fff;
  font-size: 28px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
}

.closeButton:hover {
  background: rgba(255, 255, 255, 0.1);
}

.closeButton:focus-visible {
  outline: 2px solid #fff;
  outline-offset: 2px;
}

.navList {
  list-style: none;
  padding: 0;
  margin: 0;
}

.navItem {
  margin-bottom: 8px;
}

.navLink {
  display: block;
  padding: 16px;
  color: #fff;
  text-decoration: none;
  font-size: 18px;
  border-radius: 8px;
  transition: background-color 0.2s ease;
}

.navLink:hover {
  background: rgba(255, 255, 255, 0.1);
}

.navLink:focus-visible {
  outline: 2px solid #fff;
  outline-offset: 2px;
}

.navLinkActive {
  background: rgba(83, 91, 242, 0.3);
  border-left: 3px solid #535bf2;
}
```

Key accessibility features:
- `role="dialog"` and `aria-modal="true"` for screen readers
- `aria-label="Mobile navigation"` describes the nav
- `aria-current="page"` marks active section
- Focus trap with Escape key support
- 44x44px minimum touch target for close button
- prefers-reduced-motion respected
  </action>
  <verify>
- File exists: `ls src/components/Header/MobileMenu.tsx`
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>MobileMenu component created with full accessibility support</done>
</task>

<task type="auto">
  <name>Task 2: Update Header with hamburger button and mobile menu integration</name>
  <files>src/components/Header/Header.tsx, src/components/Header/Header.module.css</files>
  <action>
Update `src/components/Header/Header.tsx`:

1. Import useState and MobileMenu:
```tsx
import { useState } from 'react';
import { MobileMenu } from './MobileMenu';
```

2. Extract navItems to a shared constant (outside component or exported):
```tsx
export const navItems: NavItem[] = [
  { label: 'Home', page: 0 },
  { label: 'Services', page: 1 },
  { label: 'About', page: 2 },
  { label: 'Contact', page: -1, isExternal: true, href: 'mailto:contact@puffpuff.dev' },
];
```

3. Add mobile menu state:
```tsx
const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
```

4. Add hamburger button (visible only on mobile via CSS):
```tsx
<button
  className={styles.hamburger}
  onClick={() => setIsMobileMenuOpen(true)}
  aria-label="Open menu"
  aria-expanded={isMobileMenuOpen}
  aria-controls="mobile-menu"
>
  <span className={styles.hamburgerLine} aria-hidden="true" />
  <span className={styles.hamburgerLine} aria-hidden="true" />
  <span className={styles.hamburgerLine} aria-hidden="true" />
</button>
```

5. Add MobileMenu component after the nav:
```tsx
<MobileMenu
  isOpen={isMobileMenuOpen}
  onClose={() => setIsMobileMenuOpen(false)}
  navItems={navItems}
  onNavigate={(page) => {
    onNavigate?.(page);
  }}
  currentPage={currentPage}
/>
```

6. Add aria-current to desktop nav links:
```tsx
aria-current={currentPage === item.page ? 'page' : undefined}
```

Update `src/components/Header/Header.module.css`:

Add hamburger button styles:
```css
.hamburger {
  display: none;
  flex-direction: column;
  justify-content: space-between;
  width: 44px;
  height: 44px;
  padding: 12px;
  background: transparent;
  border: none;
  cursor: pointer;
}

.hamburgerLine {
  display: block;
  width: 100%;
  height: 2px;
  background: #fff;
  border-radius: 1px;
  transition: transform 0.2s ease;
}

.hamburger:focus-visible {
  outline: 2px solid #fff;
  outline-offset: 2px;
  border-radius: 4px;
}

/* Show hamburger on mobile, hide nav list */
@media (max-width: 768px) {
  .hamburger {
    display: flex;
  }

  .navList {
    display: none;
  }
}
```
  </action>
  <verify>
- `npm run build` succeeds
- `npx tsc --noEmit` passes
- Resize browser to mobile width: hamburger visible, nav list hidden
- Click hamburger: mobile menu opens
- Press Escape: menu closes
- Click backdrop: menu closes
  </verify>
  <done>Header has hamburger button that opens accessible mobile menu</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm run build` succeeds
2. `npm test` passes (existing Header tests should still work)
3. Mobile view (< 768px):
   - Hamburger button visible
   - Desktop nav hidden
   - Clicking hamburger opens slide-out menu
   - Focus trapped in menu (Tab cycles through menu items)
   - Escape key closes menu
   - Clicking backdrop closes menu
   - Selecting nav item scrolls and closes menu
4. Desktop view (> 768px):
   - Hamburger hidden
   - Desktop nav visible
</verification>

<success_criteria>
- MobileMenu component with FocusTrap integration
- Header shows hamburger button on mobile
- Menu opens/closes correctly
- Focus trapped when menu open
- Body scroll locked when menu open
- Escape and backdrop click close menu
- Navigation works from mobile menu
</success_criteria>

<output>
After completion, create `.planning/phases/03-navigation-core-a11y/03-03-SUMMARY.md`
</output>
