---
phase: 05-performance-animation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.tsx
  - src/App.css
  - index.html
autonomous: true

must_haves:
  truths:
    - "LCP element (hero content) renders within 2.5 seconds on throttled connection"
    - "CLS score is 0 or near-zero (no layout shifts after initial paint)"
    - "Above-fold content has reserved space preventing shifts"
    - "Logo image has explicit dimensions and srcset for responsive images"
  artifacts:
    - path: "src/App.tsx"
      provides: "Optimized hero section with explicit dimensions and srcset"
      contains: "width.*height"
    - path: "src/App.css"
      provides: "Reserved space for dynamic content"
      contains: "min-height"
    - path: "index.html"
      provides: "Preload hints for critical resources"
      contains: "preload"
  key_links:
    - from: "index.html"
      to: "logo image"
      via: "preload link"
      pattern: "rel=\"preload\""
    - from: "src/App.css"
      to: ".hero-container"
      via: "explicit dimensions"
      pattern: "min-height.*min-width"
---

<objective>
Optimize Core Web Vitals (LCP, CLS) through explicit dimensions, preloading, srcset for responsive images, and layout stability.

Purpose: Achieve Lighthouse 90+ by fixing the primary CWV metrics that affect score.
Output: Stable layout with no CLS, fast LCP through preloading, optimized hero section with responsive images.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-performance-animation/05-RESEARCH.md

# Relevant source files
@src/App.tsx
@src/App.css
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add explicit dimensions, srcset, and preload hints</name>
  <files>
    - index.html
    - src/App.tsx
  </files>
  <action>
    1. Update index.html to add preload hints for critical resources:
       - Add preload for the logo SVG (LCP candidate):
         ```html
         <link rel="preload" as="image" href="https://raw.githubusercontent.com/PuffPuffDev/puff_puff_brand/main/logos/logo_white.svg" crossorigin>
         ```
       - Add preconnect for the GitHub raw content domain:
         ```html
         <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
         ```
       Place these in the <head> section, after the charset/viewport meta tags.

    2. Update src/App.tsx logo image to include explicit dimensions AND srcset:
       ```tsx
       <img
         src="https://raw.githubusercontent.com/PuffPuffDev/puff_puff_brand/main/logos/logo_white.svg"
         srcSet="
           https://raw.githubusercontent.com/PuffPuffDev/puff_puff_brand/main/logos/logo_white.svg 1x,
           https://raw.githubusercontent.com/PuffPuffDev/puff_puff_brand/main/logos/logo_white.svg 2x
         "
         className="logo"
         alt="Puff Puff logo"
         width="200"
         height="200"
       />
       ```

       NOTE on srcset: The logo is an SVG, which scales perfectly at any resolution.
       The srcset with 1x/2x ensures the browser knows the image is resolution-independent.
       For raster images (PNG/JPG), you would provide different sized files.

    IMPORTANT: Do NOT add loading="lazy" to the logo - it's above the fold and is the LCP element.
  </action>
  <verify>
    - index.html contains preload link for logo
    - index.html contains preconnect for GitHub domain
    - App.tsx img tag has width, height, and srcSet attributes
    - `npm run build` succeeds
  </verify>
  <done>
    - Logo preloaded for faster LCP
    - Explicit dimensions prevent CLS from image loading
    - srcset provides responsive image support
    - Preconnect reduces DNS/TLS time for external resource
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix layout stability with reserved space</name>
  <files>
    - src/App.css
  </files>
  <action>
    Update src/App.css to ensure layout stability and prevent CLS:

    1. Add explicit min-height to hero-container to reserve space:
       ```css
       .hero-container {
         min-height: 300px; /* Reserve space before content loads */
         /* existing styles... */
       }
       ```

    2. Add explicit dimensions to .logo class (if not already present):
       ```css
       .logo {
         width: 200px;
         height: 200px;
         /* or use aspect-ratio: 1 if variable sizes needed */
       }
       ```

    3. Ensure content-card has stable dimensions:
       ```css
       .content-card {
         min-height: 200px; /* Prevent collapse before hydration */
         /* existing styles... */
       }
       ```

    4. Add font-display: swap to any @font-face rules to prevent text CLS
       (Check if any custom fonts are used - if so, add font-display: swap)

    CRITICAL: Do not change visual appearance - only add stability constraints.
  </action>
  <verify>
    - `npm run dev` shows no visual changes
    - Inspect hero-container in DevTools - has min-height
    - Logo has explicit dimensions in both CSS and HTML
    - `npm run build` succeeds
  </verify>
  <done>
    - Hero section has reserved space preventing CLS
    - Logo dimensions explicit in CSS and HTML
    - Content cards have minimum dimensions
    - Layout stable from first paint to interactive
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Core Web Vitals improvements</name>
  <files>
    (verification only - no file changes)
  </files>
  <action>
    Run Lighthouse audit to verify CWV improvements:

    1. Build production version: `npm run build`
    2. Start preview server: `npm run preview`
    3. Open Chrome DevTools > Lighthouse tab
    4. Run audit with:
       - Device: Mobile
       - Categories: Performance
       - Throttling: Applied (simulated throttling)
    5. Check metrics:
       - LCP should be < 2.5s (green)
       - CLS should be < 0.1 (green)
       - FCP should be < 1.8s (green)

    If metrics are not green:
    - Check LCP element in Lighthouse report
    - Check CLS contributors in Lighthouse report
    - Document findings for next iteration

    Note: INP cannot be measured in Lighthouse - it requires real user interaction.
    The web-vitals monitoring from Plan 01 will capture INP during manual testing.
  </action>
  <verify>
    - Lighthouse Performance score visible
    - LCP reported and under target
    - CLS reported and under target
    - No critical performance issues flagged
  </verify>
  <done>
    - Lighthouse audit completed
    - Core Web Vitals measured
    - Any remaining issues documented
  </done>
</task>

</tasks>

<verification>
Run full verification:

1. `npm run build` - must succeed
2. `npm run preview` - start production preview
3. Lighthouse audit (Mobile, Performance):
   - Target: LCP < 2.5s
   - Target: CLS < 0.1
   - Target: Performance score 80+ (will reach 90+ with animation optimization)
4. Manual testing:
   - Page loads without visible layout shifts
   - Logo appears without size change
   - Hero content visible immediately
</verification>

<success_criteria>
- index.html has preload hint for logo and preconnect for GitHub
- App.tsx logo has explicit width/height attributes and srcSet
- App.css has min-height on hero-container and content-card
- Lighthouse CLS score < 0.1
- Lighthouse LCP < 2.5s on mobile
- No visible layout shifts during page load
</success_criteria>

<output>
After completion, create `.planning/phases/05-performance-animation/05-02-SUMMARY.md`
</output>
