---
phase: 08-architecture-optimization
plan: 04
type: execute
wave: 3
depends_on:
  - 08-03
files_modified:
  - package.json
  - package-lock.json
autonomous: true

must_haves:
  truths:
    - "No unused dependencies in package.json (verified via depcheck)"
    - "focus-trap-react is removed (confirmed unused in STATE.md)"
    - "All dependencies are on current stable versions (no critical security warnings)"
    - "Build and tests pass after dependency updates"
  artifacts:
    - path: "package.json"
      provides: "Clean dependency list"
      contains: "dependencies"
  key_links:
    - from: "package.json"
      to: "node_modules"
      via: "npm install syncs dependencies"
      pattern: "npm ls"
---

<objective>
Audit dependencies for unused packages and outdated versions. Remove focus-trap-react and any other unused dependencies. Update outdated packages incrementally.

Purpose: Keep dependencies lean and current for security and maintainability.
Output: Clean package.json with no unused deps and current package versions.
</objective>

<execution_context>
@/Users/romatroskin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/romatroskin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-architecture-optimization/08-CONTEXT.md
@.planning/phases/08-architecture-optimization/08-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run depcheck to identify unused dependencies</name>
  <files>package.json</files>
  <action>
Run depcheck to find unused dependencies:

```bash
npx depcheck
```

Expected output will show:
- Unused dependencies
- Unused devDependencies
- Missing dependencies (should be empty after previous plans)

Note: depcheck may report false positives for:
- react (JSX transform, not explicit import)
- vite plugins (used in config, not source)
- @types/* packages (used by TypeScript)

Document the output and verify each reported unused dependency by searching the codebase.

Known unused from STATE.md:
- focus-trap-react (confirmed unused, should be in output)
  </action>
  <verify>
    - depcheck output is captured
    - Each reported unused dep is verified by grep search
    - False positives are identified and excluded
  </verify>
  <done>
    - depcheck results documented
    - True unused dependencies identified
    - False positives filtered out
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove focus-trap-react</name>
  <files>package.json</files>
  <action>
Remove focus-trap-react which is confirmed unused:

1. First verify it's not imported anywhere:
```bash
grep -r "focus-trap" src/
```

2. If no results, remove it:
```bash
npm uninstall focus-trap-react
```

3. Verify removal:
```bash
npm ls focus-trap-react
# Should show "empty" or "not found"
```

This dependency was noted in STATE.md as unused and should be removed.
  </action>
  <verify>
    - `grep -r "focus-trap" src/` returns no results
    - focus-trap-react not in package.json dependencies
    - `npm ls focus-trap-react` shows not installed
  </verify>
  <done>
    - focus-trap-react removed from dependencies
    - No references in source code
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove other unused dependencies</name>
  <files>package.json</files>
  <action>
For each dependency identified by depcheck as unused (excluding known false positives):

1. Verify not used in source:
```bash
grep -r "package-name" src/
```

2. Verify not used in config files:
```bash
grep "package-name" vite.config.ts eslint.config.js tsconfig*.json
```

3. If truly unused, remove:
```bash
npm uninstall package-name
```

Common false positives to NOT remove:
- react, react-dom (used via JSX transform)
- vite (used as build tool)
- typescript (used by tsc)
- Any @types/* packages corresponding to used packages
- Any eslint plugins referenced in config
- vitest, @testing-library/* (used in tests)

Only remove after confirming no usage.
  </action>
  <verify>
    - Each removed dep verified as unused
    - No accidental removal of needed deps
    - `npm run build` still works
    - `npm test -- --run` still passes
  </verify>
  <done>
    - All truly unused dependencies removed
    - Build and tests still pass
  </done>
</task>

<task type="auto">
  <name>Task 4: Check for outdated dependencies</name>
  <files>package.json</files>
  <action>
Check which dependencies have newer versions available:

```bash
npm outdated
```

This shows a table with:
- Current: installed version
- Wanted: latest satisfying semver range
- Latest: latest published version

Document the output, noting:
1. Which packages have patch updates (safe)
2. Which packages have minor updates (usually safe)
3. Which packages have major updates (breaking changes possible)

Known from STATE.md:
- Vite 5.4.1 -> 6.0+ upgrade is a future decision (may defer major update)
  </action>
  <verify>
    - npm outdated output captured
    - Packages categorized by update type (patch/minor/major)
  </verify>
  <done>
    - Outdated packages documented
    - Update strategy determined
  </done>
</task>

<task type="auto">
  <name>Task 5: Apply safe updates (patch/minor)</name>
  <files>package.json, package-lock.json</files>
  <action>
Apply safe updates within semver range:

```bash
npm update
```

This updates all packages to their "wanted" version (latest within semver range in package.json).

After update:
1. Run tests:
```bash
npm test -- --run
```

2. Run build:
```bash
npm run build
```

3. Run lint:
```bash
npm run lint
```

4. Quick dev server check:
```bash
npm run dev
# Verify app loads
```

If any failures, identify the problematic package and revert if needed.
  </action>
  <verify>
    - `npm update` completes
    - `npm test -- --run` passes
    - `npm run build` succeeds
    - `npm run lint` passes
    - Dev server works
  </verify>
  <done>
    - Patch/minor updates applied
    - All verification passes
  </done>
</task>

<task type="auto">
  <name>Task 6: Evaluate major version updates</name>
  <files>package.json</files>
  <action>
For packages with major version updates available, evaluate each:

Review `npm outdated` output for packages where Latest != Wanted.

For each major update candidate:
1. Check changelog/migration guide
2. Assess breaking changes impact
3. Decide: update now, defer, or skip

Likely candidates:
- Vite 5.x -> 6.x: Defer per STATE.md unless quick win
- Any @types packages: Usually safe if corresponding package updated
- Testing libraries: Evaluate breaking changes

For packages decided to update:
```bash
npm install package-name@latest
npm test -- --run
npm run build
```

Update one at a time to isolate any issues.

Note: Major updates that require code changes should be documented and potentially deferred to a separate plan/phase.
  </action>
  <verify>
    - Each major update evaluated
    - Safe major updates applied with testing
    - Deferred updates documented
  </verify>
  <done>
    - Major updates evaluated
    - Safe updates applied
    - Deferred items documented for future
  </done>
</task>

<task type="auto">
  <name>Task 7: Final verification and security audit</name>
  <files>package.json</files>
  <action>
Run final verification:

1. Security audit:
```bash
npm audit
```

If vulnerabilities found:
- Review severity (critical, high, moderate, low)
- For high/critical: `npm audit fix` or manual update
- For moderate/low: document for future

2. Verify clean install works:
```bash
rm -rf node_modules package-lock.json
npm install
```

3. Full test suite:
```bash
npm test -- --run
```

4. Production build:
```bash
npm run build
```

5. Verify no unused deps remain:
```bash
npx depcheck
```
(Should only show expected false positives)
  </action>
  <verify>
    - `npm audit` shows no high/critical vulnerabilities
    - Fresh install works
    - All tests pass
    - Build succeeds
    - depcheck shows only expected false positives
  </verify>
  <done>
    - Security audit clean or documented
    - Clean install verified
    - All tests and build pass
    - Dependencies are lean and current
  </done>
</task>

</tasks>

<verification>
1. `npm ls | grep "UNMET"` returns empty (no unmet dependencies)
2. `npm audit --audit-level=high` returns 0 (no high/critical vulns)
3. `grep focus-trap package.json` returns empty (unused dep removed)
4. `npm test -- --run` passes all tests
5. `npm run build` succeeds
6. `npx depcheck` shows minimal/expected false positives only
</verification>

<success_criteria>
- ARCH-05: Unused dependencies removed (focus-trap-react, etc.) - COMPLETE
- ARCH-06: Outdated dependencies updated - COMPLETE
</success_criteria>

<output>
After completion, create `.planning/phases/08-architecture-optimization/08-04-SUMMARY.md`
</output>
